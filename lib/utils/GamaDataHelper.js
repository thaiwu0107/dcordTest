"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _ = require("lodash");
const joins = require("lodash-joins");
/**
 * 這個class就是幫你處理Data的後處理
 * Large是指超過一千筆資料
 * 普通就是大概100筆左右
 * @export
 * @class DataHelper
 */
class GamaDataHelper {
    static OuterJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashFullOuterJoin(aData, acc, bData, acc);
    }
    static OuterJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeFullOuterJoin(aData, acc, bData, acc);
    }
    static InnerJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashInnerJoin(aData, acc, bData, acc);
    }
    static InnerJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeInnerJoin(aData, acc, bData, acc);
    }
    static Existy(x) {
        return x !== undefined;
    }
    static Merge(aData, bData) {
        return _.assign({}, aData, bData);
    }
    static MergeList(...aData) {
        return _.reduce(aData, (sum, next) => {
            return this.Merge(sum, next);
        });
    }
    static Max(aData, key) {
        return _.maxBy(aData, key);
    }
    static Min(aData, key) {
        return _.minBy(aData, key);
    }
    static Sum(aData, key) {
        return _.sumBy(aData, key);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static RightJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeRightOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static LeftJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashLeftOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static RightJoin(aData, bData, key) {
        const acc = (a) => key;
        return joins.hashRightOuterJoin(aData, acc, bData, acc);
    }
    /**
     * 這個是取出相同的Key沒有的null
     * @param {any[]} aData 左
     * @param {any[]} bData 右
     * @param {string[]} key 相同的key
     * @returns 合併過的陣列
     * @memberof DataHelper
     */
    static LeftJoinLarge(aData, bData, key) {
        const acc = (a) => key;
        return joins.sortedMergeLeftOuterJoin(aData, acc, bData, acc);
    }
    static IntToBoolean(data, fields, toTrue = 1) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                _.toSafeInteger(data[key]) === toTrue ?
                    data[key] = true :
                    data[key] = false;
            }
        });
        return data;
    }
    static IntMoreToBoolean(data, fields, toTrue = 0) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                _.toSafeInteger(data[key]) === toTrue ?
                    data[key] = false :
                    data[key] = true;
            }
        });
        return data;
    }
    static BooleanToInt(data, fields) {
        if (_.isEmpty(data)) {
            return {};
        }
        _.forEach(fields, (key) => {
            if (!_.isUndefined(data[key])) {
                data[key] === true ?
                    data[key] = 1 :
                    data[key] = 0;
            }
        });
        return data;
    }
}
exports.default = GamaDataHelper;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR2FtYURhdGFIZWxwZXIuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2dndHRvbzQ0L0Rlc2t0b3AvYmFzZUFQSS9zcmMvIiwic291cmNlcyI6WyJ1dGlscy9HYW1hRGF0YUhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDRCQUE0QjtBQUM1QixzQ0FBc0M7QUFPdEM7Ozs7OztHQU1HO0FBQ0g7SUFDVyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUM3RCxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDTSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUNsRSxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFDTSxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQVksRUFBRSxLQUFZLEVBQUUsR0FBYTtRQUM3RCxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBQ00sTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFZLEVBQUUsS0FBWSxFQUFFLEdBQWE7UUFDbEUsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQztRQUN2QixPQUFP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T0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUMzQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7b0JBQ2hCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3JCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0NBQ0o7QUE1SEQsaUNBNEhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdmFsaWRhdGUgfSBmcm9tICdjbGFzcy12YWxpZGF0b3InO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgam9pbnMgZnJvbSAnbG9kYXNoLWpvaW5zJztcbmltcG9ydCBBbnlFbnRpdHkgZnJvbSAnLi4vbW9kZWxzL0FueUVudGl0eSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZTIHtcbiAgICBmaWVsZDogc3RyaW5nW10gfCB1bmRlZmluZWQ7XG4gICAgbm9sb2NrOiBib29sZWFuIHwgdW5kZWZpbmVkO1xufVxuLyoqXG4gKiDpgJnlgItjbGFzc+WwseaYr+W5q+S9oOiZleeQhkRhdGHnmoTlvozomZXnkIZcbiAqIExhcmdl5piv5oyH6LaF6YGO5LiA5Y2D562G6LOH5paZXG4gKiDmma7pgJrlsLHmmK/lpKfmpoIxMDDnrYblt6blj7NcbiAqIEBleHBvcnRcbiAqIEBjbGFzcyBEYXRhSGVscGVyXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWFEYXRhSGVscGVyIHtcbiAgICBwdWJsaWMgc3RhdGljIE91dGVySm9pbihhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuaGFzaEZ1bGxPdXRlckpvaW4oYURhdGEsIGFjYywgYkRhdGEsIGFjYyk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgT3V0ZXJKb2luTGFyZ2UoYURhdGE6IGFueVtdLCBiRGF0YTogYW55W10sIGtleTogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgYWNjID0gKGEpID0+IGtleTtcbiAgICAgICAgcmV0dXJuIGpvaW5zLnNvcnRlZE1lcmdlRnVsbE91dGVySm9pbihhRGF0YSwgYWNjLCBiRGF0YSwgYWNjKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBJbm5lckpvaW4oYURhdGE6IGFueVtdLCBiRGF0YTogYW55W10sIGtleTogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgYWNjID0gKGEpID0+IGtleTtcbiAgICAgICAgcmV0dXJuIGpvaW5zLmhhc2hJbm5lckpvaW4oYURhdGEsIGFjYywgYkRhdGEsIGFjYyk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgSW5uZXJKb2luTGFyZ2UoYURhdGE6IGFueVtdLCBiRGF0YTogYW55W10sIGtleTogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgYWNjID0gKGEpID0+IGtleTtcbiAgICAgICAgcmV0dXJuIGpvaW5zLnNvcnRlZE1lcmdlSW5uZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEV4aXN0eSh4KSB7XG4gICAgICAgIHJldHVybiB4ICE9PSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTWVyZ2UoYURhdGE6IGFueSwgYkRhdGE6IGFueSkge1xuICAgICAgICByZXR1cm4gXy5hc3NpZ24oe30sIGFEYXRhLCBiRGF0YSk7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgTWVyZ2VMaXN0KC4uLmFEYXRhOiBhbnlbXSkge1xuICAgICAgICByZXR1cm4gXy5yZWR1Y2UoYURhdGEsIChzdW0sIG5leHQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLk1lcmdlKHN1bSwgbmV4dCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIE1heChhRGF0YTogYW55W10sIGtleTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBfLm1heEJ5KGFEYXRhLCBrZXkpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIE1pbihhRGF0YTogYW55W10sIGtleTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBfLm1pbkJ5KGFEYXRhLCBrZXkpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFN1bShhRGF0YTogYW55W10sIGtleTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBfLnN1bUJ5KGFEYXRhLCBrZXkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDpgJnlgIvmmK/lj5blh7rnm7jlkIznmoRLZXnmspLmnInnmoRudWxsXG4gICAgICogQHBhcmFtIHthbnlbXX0gYURhdGEg5bemXG4gICAgICogQHBhcmFtIHthbnlbXX0gYkRhdGEg5Y+zXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5IOebuOWQjOeahGtleVxuICAgICAqIEByZXR1cm5zIOWQiOS9temBjueahOmZo+WIl1xuICAgICAqIEBtZW1iZXJvZiBEYXRhSGVscGVyXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBSaWdodEpvaW5MYXJnZShhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuc29ydGVkTWVyZ2VSaWdodE91dGVySm9pbihhRGF0YSwgYWNjLCBiRGF0YSwgYWNjKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICog6YCZ5YCL5piv5Y+W5Ye655u45ZCM55qES2V55rKS5pyJ55qEbnVsbFxuICAgICAqIEBwYXJhbSB7YW55W119IGFEYXRhIOW3plxuICAgICAqIEBwYXJhbSB7YW55W119IGJEYXRhIOWPs1xuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IGtleSDnm7jlkIznmoRrZXlcbiAgICAgKiBAcmV0dXJucyDlkIjkvbXpgY7nmoTpmaPliJdcbiAgICAgKiBAbWVtYmVyb2YgRGF0YUhlbHBlclxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTGVmdEpvaW4oYURhdGE6IGFueVtdLCBiRGF0YTogYW55W10sIGtleTogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgYWNjID0gKGEpID0+IGtleTtcbiAgICAgICAgcmV0dXJuIGpvaW5zLmhhc2hMZWZ0T3V0ZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiDpgJnlgIvmmK/lj5blh7rnm7jlkIznmoRLZXnmspLmnInnmoRudWxsXG4gICAgICogQHBhcmFtIHthbnlbXX0gYURhdGEg5bemXG4gICAgICogQHBhcmFtIHthbnlbXX0gYkRhdGEg5Y+zXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5IOebuOWQjOeahGtleVxuICAgICAqIEByZXR1cm5zIOWQiOS9temBjueahOmZo+WIl1xuICAgICAqIEBtZW1iZXJvZiBEYXRhSGVscGVyXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBSaWdodEpvaW4oYURhdGE6IGFueVtdLCBiRGF0YTogYW55W10sIGtleTogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgYWNjID0gKGEpID0+IGtleTtcbiAgICAgICAgcmV0dXJuIGpvaW5zLmhhc2hSaWdodE91dGVySm9pbihhRGF0YSwgYWNjLCBiRGF0YSwgYWNjKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICog6YCZ5YCL5piv5Y+W5Ye655u45ZCM55qES2V55rKS5pyJ55qEbnVsbFxuICAgICAqIEBwYXJhbSB7YW55W119IGFEYXRhIOW3plxuICAgICAqIEBwYXJhbSB7YW55W119IGJEYXRhIOWPs1xuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IGtleSDnm7jlkIznmoRrZXlcbiAgICAgKiBAcmV0dXJucyDlkIjkvbXpgY7nmoTpmaPliJdcbiAgICAgKiBAbWVtYmVyb2YgRGF0YUhlbHBlclxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTGVmdEpvaW5MYXJnZShhRGF0YTogYW55W10sIGJEYXRhOiBhbnlbXSwga2V5OiBzdHJpbmdbXSkge1xuICAgICAgICBjb25zdCBhY2MgPSAoYSkgPT4ga2V5O1xuICAgICAgICByZXR1cm4gam9pbnMuc29ydGVkTWVyZ2VMZWZ0T3V0ZXJKb2luKGFEYXRhLCBhY2MsIGJEYXRhLCBhY2MpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEludFRvQm9vbGVhbihkYXRhOiBhbnksIGZpZWxkczogc3RyaW5nW10sIHRvVHJ1ZSA9IDEpIHtcbiAgICAgICAgaWYgKF8uaXNFbXB0eShkYXRhKSkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIF8uZm9yRWFjaChmaWVsZHMsIChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkYXRhW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgXy50b1NhZmVJbnRlZ2VyKGRhdGFba2V5XSkgPT09IHRvVHJ1ZSA/XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IHRydWUgOlxuICAgICAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIEludE1vcmVUb0Jvb2xlYW4oZGF0YTogYW55LCBmaWVsZHM6IHN0cmluZ1tdLCB0b1RydWUgPSAwKSB7XG4gICAgICAgIGlmIChfLmlzRW1wdHkoZGF0YSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgICBfLmZvckVhY2goZmllbGRzLCAoa2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YVtrZXldKSkge1xuICAgICAgICAgICAgICAgIF8udG9TYWZlSW50ZWdlcihkYXRhW2tleV0pID09PSB0b1RydWUgP1xuICAgICAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSBmYWxzZSA6XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBCb29sZWFuVG9JbnQoZGF0YTogYW55LCBmaWVsZHM6IHN0cmluZ1tdKSB7XG4gICAgICAgIGlmIChfLmlzRW1wdHkoZGF0YSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgICBfLmZvckVhY2goZmllbGRzLCAoa2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YVtrZXldKSkge1xuICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9PT0gdHJ1ZSA/XG4gICAgICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IDEgOlxuICAgICAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxufVxuIl19